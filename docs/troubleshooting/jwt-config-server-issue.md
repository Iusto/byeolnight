## π“… 2025λ…„ 9μ›” 18μΌ μ¤μ „ 7μ‹, μ΄μ μ„λ²„ μ¥μ•  λ°μƒ

ν‰μ†μ™€ κ°™μ΄ μ»¤ν”Ό ν• μ”κ³Ό ν•¨κ» λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“λ¥Ό ν™•μΈν•λ μ¤‘, **λ³„ ν—¤λ” λ°¤** μ„λΉ„μ¤μ— μ ‘μ†μ΄ μ• λλ” κ²ƒμ„ λ°κ²¬ν–λ‹¤. λΈλΌμ°μ €μ—λ” λ¬΄μ •ν•κ²λ„ `ERR_TOO_MANY_REDIRECTS` μ¤λ¥λ§ λ°λ³µλκ³  μμ—λ‹¤.

> "μ–΄μ κΉμ§€ μ λλ μ‚¬μ΄νΈκ°€ κ°‘μκΈ° μ™...?"

## π” μ²« λ²μ§Έ μ©μμ: Nginx λ¦¬λ‹¤μ΄λ ‰νΈ μ¤‘λ³µ

μ²μμ—λ” λ‹Ήμ—°ν **Nginx μ„¤μ • λ¬Έμ **λΌκ³  μƒκ°ν–λ‹¤. μµκ·Ό λ°°ν¬ κ³Όμ •μ—μ„ λ©”μΈ μ„λ²„μ™€ ν”„λ΅ νΈμ—”λ“μ— μλ” `nginx.conf` νμΌ λ‘ λ‹¤ λ¦¬λ‹¤μ΄λ ‰νΈ μ½”λ“κ°€ μ¤‘λ³µλμ–΄ μμ—κ³ , API ν‚¤λ¥Ό μ—¬λ¬ λ² νΈμ¶ν•΄μ•Ό ν•λ” μ°λ¦¬ μ›Ήμ„λΉ„μ¤ νΉμ„±μƒ μ΄κ² κ·Όλ³Έ μ›μΈμΌ κ±°λΌ ν™•μ‹ ν–λ‹¤.

```bash
# κΈ‰ν•κ² Nginx μ„¤μ • μμ •
vim /etc/nginx/nginx.conf
# μ¤‘λ³µλ λ¦¬λ‹¤μ΄λ ‰νΈ κ·μΉ™ μ κ±°
sudo systemctl reload nginx
```

λ‹¤ν–‰ν μμ • ν›„ μ„λΉ„μ¤κ°€ μ •μƒν™”λμ—λ‹¤. "μ—­μ‹ Nginx λ¬Έμ μ€κµ¬λ‚" ν•λ©° μ•λ„μ ν•μ¨μ„ μ‰¬μ—λ‹¤.

## π± λ°μλ·°: λ λ‹¤μ‹ λ°μƒν• λ™μΌ μ¦μƒ

λ©°μΉ  ν›„, μ„λΉ„μ¤κ°€ μ κµ΄λ¬κ°€κ³  μλ‹¤κ³  μƒκ°ν•λ©° μƒλ΅μ΄ κΈ°λ¥μ„ λ°°ν¬ν–λ‹¤. κ·Έλ°λ°...

**λ κ°™μ€ μ΄μκ°€ λ°μƒν–λ‹¤!**

μ΄λ²μ—λ” λΈλΌμ°μ € μ¤λ¥κ°€ μ•„λ‹λΌ **μ„λ²„ λ΅κ·Έ**μ—μ„ λ” μ‹¬κ°ν• λ¬Έμ λ¥Ό λ°κ²¬ν–λ‹¤:

```
2025-09-18T07:01:29.821+09:00 ERROR 1 --- [byeolnight] [main] 
Caused by: java.lang.IllegalArgumentException: 
Could not resolve placeholder 'app.security.jwt.secret' in value "${app.security.jwt.secret}"
```

> "Nginx λ¬Έμ κ°€ μ•„λ‹μ—λ‹¤... μ§„μ§ μ›μΈμ€ λ”°λ΅ μμ—κµ¬λ‚."

## π•µοΈ μ§„μ§ λ²”μΈμ„ μ°Ύμ•„μ„

### "Config Serverλ” μ‚΄μ•„μλ”λ° JWTλ§ μ£½μ—λ‹¤?"

λ΅κ·Έλ¥Ό μμ„Έν λ³΄λ‹ μ΄μƒν• μ μ΄ μμ—λ‹¤:

```
β… Located environment: name=byeolnight, profiles=[prod]
β… MySQL λΉ„λ°€λ²νΈ: μ •μƒ λ³µνΈν™”
β… Redis λΉ„λ°€λ²νΈ: μ •μƒ λ³µνΈν™”  
β… AWS API ν‚¤λ“¤: μ •μƒ λ³µνΈν™”
β JWT μ‹ν¬λ¦Ώ: Could not resolve placeholder
```

> "λ‹¤λ¥Έ μ•”νΈν™”λ μ„¤μ •λ“¤μ€ λ©€μ©΅ν•λ° JWT μ‹ν¬λ¦Ώλ§ μ™...?"

### λ―Έμ¤ν„°λ¦¬ν• μ•”νΈν™” λ°μ΄ν„°

`byeolnight-prod.yml` νμΌμ„ μ—΄μ–΄λ³΄λ‹ JWT μ‹ν¬λ¦Ώμ΄ μ΄μƒν–λ‹¤:

```yaml
# μ •μƒμ μΈ λ‹¤λ¥Έ μ„¤μ •λ“¤
password: '{cipher}4f645acb62e6302d47f02b2d3b88c8cda3c90e64f91d042dc9ff2613955ba***'

# λ¬Έμ μ JWT μ‹ν¬λ¦Ώ
jwt:
  secret: '{cipher}eaebecbd17000326cf1b0281b5e9b9c905f10300270c747f95207cea0c029d34***'
```

**μ¶”λ¦¬ κ²°κ³Ό:**
- νμΌ λ³µμ‚¬ κ³Όμ •μ—μ„ μ•”νΈν™” λ°μ΄ν„° μΌλ¶€ μ†μ‹¤?
- Git μ»¤λ°‹ μ‹ μΈμ½”λ”© λ¬Έμ ?
- λ‹¤λ¥Έ μ•”νΈν™” ν‚¤λ΅ μ•”νΈν™”λ μ΄λ ¥?

> "λ²”μΈμ€... μ†μƒλ μ•”νΈν™” λ°μ΄ν„°μ€λ‹¤!"

## π‘ μ‘κΈ‰μ²μΉ: μΌλ‹¨ μ‚΄λ ¤λ†“κ³  λ³΄μ

### "ν‰λ¬ΈμΌλ΅λΌλ„ μΌλ‹¨ μ„λΉ„μ¤λ¶€ν„° μ‚΄λ¦¬μ!"

μ΄μ μ„λΉ„μ¤κ°€ λ‹¤μ΄λ μƒν™©μ—μ„ μ›μΈ λ¶„μ„λ³΄λ‹¤λ” **λΉ λ¥Έ λ³µκµ¬**κ°€ μ°μ„ μ΄μ—λ‹¤.

```yaml
# μ‘κΈ‰μ²μΉ: JWT μ‹ν¬λ¦Ώμ„ ν‰λ¬ΈμΌλ΅ λ³€κ²½
jwt:
  secret: '********************-REDACTED-********************'
```

```bash
# μ„λ²„ μ¬μ‹μ‘
docker-compose restart app
```

> "ν΄... μΌλ‹¨ μ„λΉ„μ¤λ” μ‚΄μ•„λ‚¬λ‹¤. μ΄μ  μ§„μ§ ν•΄κ²°μ±…μ„ μ°Ύμ•„λ³΄μ."

## π”§ κ·Όλ³Έ ν•΄κ²°: Config Serverλ΅ μ¬μ•”νΈν™”

### "EC2 μ„λ²„μ— μ§μ ‘ μ ‘μ†ν•΄μ„ ν•΄κ²°ν•μ!"

ν‰λ¬ΈμΌλ΅ μ„μ‹ ν•΄κ²°ν• ν›„, λ³΄μ•μ„ μ„ν•΄ **EC2 μ„λ²„μ— μ§μ ‘ μ ‘μ†ν•μ—¬ Config Serverμ μ•”νΈν™” μ—”λ“ν¬μΈνΈλ¥Ό νΈμ¶**ν•λ” λ°©μ‹μΌλ΅ μ¬μ•”νΈν™”λ¥Ό μ§„ν–‰ν–λ‹¤.

```bash
# 1λ‹¨κ³„: EC2 μ„λ²„μ— SSH μ ‘μ†
ssh -i byeolnight-key.pem ec2-user@<EC2-IP>

# 2λ‹¨κ³„: Config Serverκ°€ μ‹¤ν–‰ μ¤‘μΈ μƒνƒμ—μ„ μ§μ ‘ μ•”νΈν™” μ”μ²­
curl -X POST http://localhost:8888/encrypt \
  -H "Content-Type: text/plain" \
  -d "********************-REDACTED-********************"
```

**ν„°λ―Έλ„ μ¶λ ¥:**
```
8bab426a814eb620e297d3a336d22ebf6ede3b285003154b24898d87ba743416***[μƒλ΅μ΄ μ•”νΈν™” ν‚¤ μƒμ„±λ¨]
```

> "EC2 μ„λ²„μ—μ„ μ§μ ‘ μ•”νΈν™”ν•λ‹ ν™•μ‹¤ν•κ³  μ•μ „ν•λ‹¤!"

### μµμΆ… ν•΄κ²°: μƒ μ•”νΈν™” ν‚¤ μ μ©

```yaml
# byeolnight-prod.yml μµμΆ… μμ •
jwt:
  secret: '{cipher}8bab426a814eb620e297d3a336d22ebf6ede3b285003154b24898d87ba743416***'
```

## π‰ ν•΄ν”Όμ—”λ”©: λ³„ ν—¤λ” λ°¤μ΄ λ‹¤μ‹ λΉ›λ‚¬λ‹¤

### "λ“λ””μ–΄ μ •μƒ λ΅κ·Έκ°€ λ–΄λ‹¤!"

```bash
# μ„λ²„ μ¬μ‹μ‘ ν›„ λ΅κ·Έ ν™•μΈ
docker logs -f byeolnight-app-1
```

**κΈ°λ‹¤λ¦¬λ μ„±κ³µ λ΅κ·Έ:**
```
β… JwtAuthenticationFilter: Filter 'jwtAuthenticationFilter' configured for use
β… TomcatWebServer: Tomcat started on port 8080 (http)  
β… ByeolnightApplication: Started ByeolnightApplication in 28.808 seconds
β… λ³„ ν—¤λ” λ°¤μ΄ λ‹¤μ‹ μ‚΄μ•„λ‚¬μµλ‹λ‹¤! π
```

### κ²€μ¦: λ¨λ“  κΈ°λ¥μ΄ μ •μƒ μ‘λ™

- β… JWT ν† ν° μƒμ„±/κ²€μ¦ μ™„λ²½
- β… μ‚¬μ©μ λ΅κ·ΈμΈ/λ΅κ·Έμ•„μ›ƒ μ •μƒ
- β… API νΈμ¶ μΈμ¦ μ„±κ³µ
- β… μ†μ… λ΅κ·ΈμΈ (Google, Kakao, Naver) μ •μƒ
- β… μ‹¤μ‹κ°„ μ±„ν… WebSocket μ—°κ²° μ„±κ³µ

> "μ΄μ μ•Ό λ§μ λ†“κ³  μ»¤ν”Όλ¥Ό λ§μ‹¤ μ μκ² λ‹¤... β•"

## π”§ μ‚¬μ©λ λ„κµ¬ λ° κΈ°μ 

### Config Server μ•”νΈν™” κµ¬μ΅°
```yaml
# Config Server (application.yml)
encrypt:
  key: '********************-REDACTED-********************'
  fail-on-error: false
```

### μ•”νΈν™” λ°©μ‹ (EC2 μ„λ²„ μ§μ ‘ μ ‘μ†)
```bash
# EC2 μ„λ²„μ— SSH μ ‘μ† ν›„ Config Serverμ /encrypt μ—”λ“ν¬μΈνΈλ¥Ό μ§μ ‘ νΈμ¶
curl -X POST http://localhost:8888/encrypt \
  -H "Content-Type: text/plain" \
  -d "μ•”νΈν™”ν•  κ°’"
```

### JWT μ„¤μ • κµ¬μ΅°
```java
@Component
public class JwtTokenProvider {
    public JwtTokenProvider(@Value("${app.security.jwt.secret}") String secret, 
                           StringRedisTemplate redisTemplate) {
        this.key = Keys.hmacShaKeyFor(secret.getBytes(StandardCharsets.UTF_8));
        this.redisTemplate = redisTemplate;
    }
}
```

## π“ ν•™μµ ν¬μΈνΈ

### Spring Cloud Config μ•”νΈν™” νΉμ„±
- **λ€μΉ­ν‚¤ μ•”νΈν™” (AES)** μ‚¬μ©
- **μ‹κ°„ κΈ°λ° λ§λ£ μ—†μ** (JWTμ™€ λ‹¤λ¦„)
- **μ•”νΈν™” ν‚¤ μΌμΉ μ‹** μ–Έμ λ“  λ³µνΈν™” κ°€λ¥
- **λ°μ΄ν„° λ¬΄κ²°μ„±** μ¤‘μ”

### λ¬Έμ  ν•΄κ²° μ ‘κ·Όλ²•
1. **μ¦μƒ vs μ›μΈ** κµ¬λ¶„
2. **λ‹¤λ¥Έ μ„¤μ •κ³Ό λΉ„κµ** λ¶„μ„
3. **λ‹¨κ³„λ³„ κ²€μ¦** (μ„μ‹ β†’ μκµ¬ ν•΄κ²°)
4. **μ¬ν„ κ°€λ¥ν• ν•΄κ²°μ±…** μ μ©

### μ΄μ ν™κ²½ κ³ λ ¤μ‚¬ν•­
- Config Server **κ³ κ°€μ©μ„±** ν•„μ”
- μ•”νΈν™” ν‚¤ **λ°±μ—… λ° κ΄€λ¦¬**
- **λ¨λ‹ν„°λ§ λ° μ•λ¦Ό** μ²΄κ³„
- **λ΅¤λ°± κ³„ν** μλ¦½

## π€ ν–¥ν›„ κ°μ„  λ°©μ•

### 1. λ¨λ‹ν„°λ§ κ°•ν™”
```yaml
# Config Server Health Check
management:
  endpoints:
    web:
      exposure:
        include: health,info,decrypt
```

### 2. μ•”νΈν™” κ²€μ¦ μλ™ν™”
```bash
# λ°°ν¬ μ „ μ•”νΈν™” κ²€μ¦ μ¤ν¬λ¦½νΈ
validate-config.sh byeolnight prod
```

### 3. λ°±μ—… μ „λµ
- Config νμΌ **Git μ΄λ ¥ κ΄€λ¦¬**
- μ•”νΈν™” ν‚¤ **μ•μ „ν• μ €μ¥μ†** λ³΄κ΄€
- **λ³µκµ¬ μ μ°¨** λ¬Έμ„ν™”

## π“ μ΄ μ‚¬κ±΄μ—μ„ λ°°μ΄ κµν›λ“¤

### 1. "μ¦μƒκ³Ό μ›μΈμ€ λ‹¤λ¥Ό μ μλ‹¤"
- μ²μ `ERR_TOO_MANY_REDIRECTS`λ” Nginx λ¬Έμ λ΅ λ³΄μ€μ§€λ§
- μ§„μ§ μ›μΈμ€ **JWT μ•”νΈν™” λ°μ΄ν„° μ†μƒ**μ΄μ—λ‹¤
- **κ·Όλ³Έ μ›μΈ**μ„ μ°Ύμ§€ μ•μΌλ©΄ κ°™μ€ λ¬Έμ κ°€ λ°λ³µλλ‹¤

### 2. "Config Server μ•”νΈν™”λ” μƒκ°λ³΄λ‹¤ μ·¨μ•½ν•λ‹¤"
- νμΌ λ³µμ‚¬, Git μ»¤λ°‹ κ³Όμ •μ—μ„ λ°μ΄ν„° μ†μƒ κ°€λ¥
- **μ •κΈ°μ μΈ μ•”νΈν™” λ°μ΄ν„° κ²€μ¦**μ΄ ν•„μ”ν•λ‹¤
- λ°±μ—…λ μ•”νΈν™” ν‚¤ κ΄€λ¦¬μ μ¤‘μ”μ„±

### 3. "μ‘κΈ‰μ²μΉ β†’ κ·Όλ³Έν•΄κ²° μμ„κ°€ μ¤‘μ”ν•λ‹¤"
- μ΄μ μ„λΉ„μ¤ λ‹¤μ΄ μ‹: **λΉ λ¥Έ λ³µκµ¬ μ°μ„ **
- μ•μ •ν™” ν›„: **λ³΄μ•μ„ κ³ λ ¤ν• κ·Όλ³Έ ν•΄κ²°**
- ν‰λ¬Έ β†’ μ¬μ•”νΈν™” λ‹¨κ³„μ  μ ‘κ·Όμ΄ ν¨κ³Όμ 

---

**μ—ν•„λ΅κ·Έ:** κ·Έλ‚  λ°¤, λ³„ ν—¤λ” λ°¤ μ„λΉ„μ¤λ” λ‹¤μ‹ ν‰ν™”λ΅­κ² μ‚¬μ©μλ“¤μ μ°μ£Ό μ΄μ•ΌκΈ°λ¥Ό λ‹΄μ•„λ‚΄κ³  μμ—λ‹¤. λ•λ΅λ” μμƒμΉ λ»ν• κ³³μ—μ„ λ¬Έμ κ°€ λ°μƒν•μ§€λ§, **μ°¨κ·Όμ°¨κ·Ό μ›μΈμ„ μ°Ύμ•„ ν•΄κ²°ν•λ” κ³Όμ •**μ΄μ•Όλ§λ΅ κ°λ°μμ μ§„μ§ μ‹¤λ ¥μ΄ μ•„λ‹κΉ? π™β¨