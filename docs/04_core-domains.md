# 04. 핵심 도메인별 구조

> 실제 구현된 도메인 모델 중, 주요 도메인의 특징과 설계 이유를 설명합니다.

## 1️⃣ 인증 도메인 (`auth`)

* **주요 엔티티**: `User`, `PasswordResetToken`
* **특징**:

    * 이메일 + SMS 2단계 인증 구조
    * Refresh Token을 Redis에 저장해 무상태 유지
    * 계정 잠금 정책 (5회 실패 시 30분 잠금)
    * 로그인 실패/갱신 로그 별도 기록
* **설계 이유**:

    * 인증 상태를 Redis에 위임하여 서버 확장성 확보
    * 보안성과 UX의 균형을 맞춘 자동 갱신 구조 적용

## 2️⃣ 게시글 도메인 (`post`)

* **주요 엔티티**: `Post`, `Comment`, `PostLike`, `PostReport`
* **특징**:

    * 댓글 재귀적 구조 + 좋아요/신고 기능
    * 인기글 선정 로직 별도 관리
    * 게시글 신고 → 관리자 처리 → 블라인드 처리까지 연동
    * **블라인드 처리**: 관리자 전용 기능 (소프트 삭제 분리)
      - 일반 사용자: 자신의 게시글만 삭제 가능 (소프트 삭제)
      - 관리자: 블라인드 처리 (관리자만 조회 가능, 일반 사용자 차단)
      - 탈퇴 사용자 게시글 유지: 작성자 탈퇴 시에도 게시글은 삭제되지 않음
* **설계 이유**:

    * Post를 Aggregate Root로 설정하여, 모든 행위가 Post 내부에서 일어나도록 제한
    * 부적절 콘텐츠 블라인드 처리와 사용자 삭제 흐름을 명확히 분리
    * 관리자 권한과 사용자 권한을 도메인 레벨에서 명확히 구분

## 3️⃣ 쪽지 도메인 (`message`)

* **주요 엔티티**: `Message`
* **특징**:

    * Soft Delete 지원 (보낸 사람/받는 사람 각자 삭제)
    * 3년 경과 시 자동 영구 삭제
    * 탈퇴 사용자 쪽지는 '탈퇴한 사용자'로 치환
* **설계 이유**:

    * 사용자 중심 메시지 흐름을 기준으로 도메인을 설계
    * 실제 메신저 UX를 반영한 읽음 처리/삭제 설계

## 4️⃣ 알림 도메인 (`notification`)

* **주요 엔티티**: `Notification`
* **특징**:

    * WebSocket + 브라우저 알림 연동
    * 읽음/안읽음 상태 + 일괄 읽음 처리
    * 알림 삭제 가능 (X 버튼 UI 포함)
* **설계 이유**:

    * Notification을 별도 애그리거트로 분리하여 복잡한 사용자 간 알림 로직을 격리
    * DB 저장 + 실시간 푸시 이중 채널 제공

## 5️⃣ 채팅 도메인 (`chat`)

* **주요 엔티티**: `ChatMessage`, `ChatBan`, `ChatParticipation`
* **특징**:

    * STOMP 기반 공개 채팅방 구조
    * 금지 사용자/차단 IP 관리
    * 메시지 읽기 전용 권한 분리
* **설계 이유**:

    * 실시간 특성을 고려하여 Redis Pub/Sub 구조 도입 예정
    * 사용자 상태와 권한 흐름을 명확히 분리하여 책임 최소화

## 6️⃣ 상점 도메인 (`shop`)

* **주요 엔티티**: `StellaIcon`, `UserIcon`
* **특징**:

    * 포인트로 아이콘 구매
    * 6단계 등급 시스템 (FREE/COMMON/RARE/EPIC/LEGENDARY/MYTHIC)
    * 실시간 미리보기 기능
* **설계 이유**:

    * 구매와 보유 이력을 Aggregate로 분리하여 사이드 이펙트 최소화
    * 도메인 내부에 '아이콘의 가치'와 관련된 도메인 룰 내장

## 7️⃣ 인증서 도메인 (`certificate`)

* **주요 엔티티**: `Certificate`, `UserCertificate`
* **특징**:

    * 활동 기반 자동 인증서 발급
    * 대표 인증서 설정 기능
* **설계 이유**:

    * 수동 발급이 아닌 자동 조건 평가 로직을 통해 도메인 로직으로 내재화
    * 대표 인증서 여부를 UserCertificate 수준에서 관리

## 8️⃣ 뉴스/영상 도메인 (`news`, `cinema`)

* **주요 엔티티**: `News`, `Cinema`
* **특징**:

    * NewsData API → AI 요약/분류 → 게시
    * YouTube 영상 자동 수집 + 요약/번역
    * 비우주 키워드 필터링 로직 적용
* **설계 이유**:

    * 외부 데이터와 내부 도메인을 연결하는 경계 레이어로 구성
    * 콘텐츠 유입을 자동화하면서도 신뢰성 확보

## 9️⃣ 건의사항 도메인 (`suggestion`)

* **주요 엔티티**: `Suggestion`
* **특징**:

    * 공개/비공개 건의사항 작성 가능
    * 본인만 수정/삭제 가능
    * 관리자 모니터링 기능 존재
* **설계 이유**:

    * 게시글 도메인과 분리하여 독립 흐름 구성
    * 운영자 피드백 및 응답 플로우를 별도 관리

## 🔄 기타 지원 도메인

* **삭제 로그 (`DeleteLog`)**: 게시글/댓글/쪽지 삭제 작업 자동 기록
* **포인트 시스템**: 출석/활동/신고에 따른 적립/차감 로직
* **AI 도메인 (`ai`)**: Claude/OpenAI 연동 및 키워드 필터링

---

👉 다음 문서: [05. 성능 최적화 전략](./05_optimizations.md)
