# 05. 성능 최적화 전략

> 운영 환경에서 확인된 병목 지점을 구체적으로 분석하고 개선했습니다.

## 🧠 인덱스 튜닝 사례

### 1. 게시글 목록 조회 속도 개선

* **문제**: 카테고리별 정렬 시 Full Scan + filesort 발생
* **해결**: 복합 인덱스 `(category, created_at)` 적용
* **결과**: 응답 속도 15% 개선, CPU 사용률 감소

### 2. 채팅 메시지 조회 개선

* **문제**: roomId만 조건일 경우 성능 저하
* **해결**: 복합 인덱스 `(room_id, timestamp)` 적용
* **결과**: 실시간 채팅 UX 개선, 메모리 사용률 안정화

### 3. 댓글 조회 최적화

* **문제**: post\_id로 댓글 조회 시 정렬 병목
* **해결**: 복합 인덱스 `(post_id, created_at)` 적용
* **결과**: 댓글 많은 게시글의 조회 속도 향상

## ⚙️ 기술 적용 기반 최적화

### 1. 이미지 업로드 → Presigned URL 통일

* **기존**: 서버 전송 방식과 S3 직접 업로드 혼재
* **개선**: 모든 파일 업로드를 Presigned URL 방식으로 통일
* **성과**: 서버 부하 33% 감소, 업로드 속도 67% 향상

### 2. WebSocket 하트비트 + 재연결 로직

* **문제**: 모바일 환경 등에서 NAT 타임아웃 발생
* **해결**:

    * 하트비트 주기 설정 (`4초`)
    * 지수 백오프 재연결 + 수동 재시도 버튼 제공
* **성과**: 연결 안정성 95% → 99% 개선, 사용자 불만 감소

### 3. JWT 자동 갱신

* **문제**: 글 작성 중 토큰 만료 → 데이터 손실
* **해결**: Axios 인터셉터 기반 자동 갱신 로직 구현
* **성과**: 토큰 만료 이슈 95% 감소

### 4. 소셜 계정 탈퇴 복구 시스템

* **문제**: 탈퇴 시 완전 초기화 → 데이터 완전 손실
* **해결**: 
  * 30일 내 완전 복구 시스템 구축
  * 이메일 기반 고유 닉네임 자동 생성
  * 단계별 데이터 정리 (30일/5년)
* **성과**: 탈퇴 후 데이터 손실 문제 100% 해결, 개인정보보호법 준수

## 🧼 시스템 정리 및 비용 최적화

* **orphan image 정리**: 게시글 작성 취소 시 남은 이미지 → 7일 후 자동 삭제
* **삭제 로그 자동화**: 모든 삭제 작업 자동 기록 + 관리자 조회 제공
* **AI 키워드 필터링**: 우주 맥락 없는 영상/뉴스 사전 차단
* **ReactMarkdown 최적화**: iframe 렌더링 문제 → `rehype-raw` 추가로 해결
* **소셜 계정 데이터 정리**: 단계별 자동 정리로 저장소 비용 최적화 및 개인정보보호법 준수

---

👉 다음 문서: [06. 기술 스택](./06_tech-stack.md)