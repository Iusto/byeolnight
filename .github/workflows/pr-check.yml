name: PR 검증

on:
  pull_request:
    branches: [ main, develop ]
    types: [opened, synchronize, reopened]

jobs:
  pr-validation:
    name: PR 유효성 검사
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # 전체 히스토리 가져오기

    - name: 변경된 파일 분석
      id: changed-files
      uses: tj-actions/changed-files@v42
      with:
        files_yaml: |
          backend:
            - 'src/**'
            - 'build.gradle'
            - 'Dockerfile'
          frontend:
            - 'byeolnight-frontend/**'
          docs:
            - 'docs/**'
            - '*.md'
          config:
            - 'docker-compose*.yml'
            - '.github/**'

    - name: 변경 사항 요약
      run: |
        echo "## 📊 변경 사항 분석" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [[ "${{ steps.changed-files.outputs.backend_any_changed }}" == "true" ]]; then
          echo "🔧 **백엔드 변경**: ${{ steps.changed-files.outputs.backend_all_changed_files }}" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [[ "${{ steps.changed-files.outputs.frontend_any_changed }}" == "true" ]]; then
          echo "🎨 **프론트엔드 변경**: ${{ steps.changed-files.outputs.frontend_all_changed_files }}" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [[ "${{ steps.changed-files.outputs.docs_any_changed }}" == "true" ]]; then
          echo "📚 **문서 변경**: ${{ steps.changed-files.outputs.docs_all_changed_files }}" >> $GITHUB_STEP_SUMMARY
        fi

